<!DOCTYPE html>
<html lang="en">

<head>
    <title></title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="manifest" href="/manifest.json">

</head>

<body>
    <div>
        <h2>Welcome to Boffo</h2>
    </div>
</body>

<script>
    const applicationServerPublicKey = 'BDLsjYkCzbGGITXQNxyLovgX7LjZm5iPr7f7NogwiOMBog9K5K5FAr5QG75ebO3kTfqvKbjdhj41-AOalYCxwLs';

    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('serviceWorker.js')
            .then(function (registration) {
                console.log('Registration successful, scope is:', registration.scope);
                console.log('Registration successful, scope info:', registration);

                swRegistration = registration;

                 initiaizePushManager();
            })
            .catch(function (error) {
                console.log('Service worker registration failed, error:', error);
            });
    }
    else {
        console.log('Service Worker not supported');
    }

    function urlB64ToUint8Array(base64String) {
        const padding = '='.repeat((4 - base64String.length % 4) % 4);
        const base64 = (base64String + padding)
            .replace(/\-/g, '+')
            .replace(/_/g, '/');

        const rawData = window.atob(base64);
        const outputArray = new Uint8Array(rawData.length);

        for (let i = 0; i < rawData.length; ++i) {
            outputArray[i] = rawData.charCodeAt(i);
        }
        return outputArray;
    }

    function initiaizePushManager() {

        if ('PushManager' in window) {
            console.log(' Push Manager is supported ');


            const applicationServerKey = urlB64ToUint8Array(applicationServerPublicKey);
            swRegistration.pushManager.subscribe({
                userVisibleOnly: true,
                applicationServerKey: applicationServerKey
            })
                .then(function (subscription) {
                    console.log('User is subscribed. ' + JSON.stringify(subscription));

                    //updateSubscriptionOnServer(subscription);

                    isSubscribed = true;

                    //updateBtn();
                })
                .catch(function (err) {
                    console.log('Failed to subscribe the user: ', err);
                    //updateBtn();
                });




        }
        else {
            console.log(' Push Manager is not supported ');
        }

    }

    /*
    

    
    
    */

</script>

</html>


